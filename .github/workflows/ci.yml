# Name of the workflow
name: Python CI/CD

on: [push, pull_request]

# Define the jobs to run
jobs:
  build:
    # Run on the latest Ubuntu environment
    runs-on: ubuntu-latest
    
    # Use a matrix strategy to test across multiple Python versions
    strategy:
      matrix:
        python-version: ['3.10']

    steps:
      # Step 1: Check out the repository code
      - uses: actions/checkout@v4

      # Step 2: Set up Python environment
      - name: Set up Python ${{ matrix.python-version }}
        uses: actions/setup-python@v5
        with:
          python-version: ${{ matrix.python-version }}
          # Optional: Caching the environment can speed up subsequent runs
          # cache: 'pip'

      # Step 3: Install dependencies (assuming a requirements.txt file exists)
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install pylint pytest pytest-cov
          if [ -f requirements.txt ]; then pip install -r requirements.txt; fi # Install other project dependencies

      # Step 4: Run Linting with Pylint
      - name: Lint with Pylint
        run: |
          pylint src/
          #pylint src/ --fail-under=8.0 # Fails the step if the Pylint score is under 8.0/10

      # Step 5: Run tests with Pytest
      - name: Test with Pytest
        run: |
          # Discovers and runs tests in the 'tests/' directory (change as needed)
          # Generates a coverage report
          pytest tests/ --cov=src/ --cov-report=xml --cov-fail-under=50 # Fails if test coverage is below 50%
